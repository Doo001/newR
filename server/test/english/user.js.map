{"version":3,"sources":["webpack:///./js/user/common.jsx","webpack:///./js/user/entry.jsx","webpack:///./js/user/login.jsx","webpack:///./js/user/manageuser.jsx","webpack:///./js/user/oplogs.jsx","webpack:///./js/user/stats.jsx","webpack:///./js/user/userinfo.jsx","webpack:///./js/user/userlist.jsx","webpack:///external \"React\"?9de9","webpack:///external \"ReactDOM\"?4ab4","webpack:///external \"jQuery\"?0cb8","webpack:///external \"Immutable\"?d3b4","webpack:///external \"Global\"?3bd4","webpack:///external \"ReactRouter\"?a8d3","webpack:///external \"Raven\"?5a37"],"names":["setCurrentNav","current","uid","profile","navItems","permissions","Global","user","filter","p","length","push","setNavBar","UserRole","role","kAdmin","kDescDict","kUser","UserModule","kAllModules","code","desc","forEach","item","kMathDepartment","UserPermission","module","kAll","concat","ReactDom","render","document","getElementById","UserLogin","genImgSrc","server","config","Math","random","loginError","_refPass","focus","setState","pass","refreshCode","state","email","window","localStorage","getItem","capacha","remember","ajaxing","imgSrc","_refEmail","_autoFocusInput","evt","value","target","type","checked","name","codeImg","setAttribute","preventDefault","Q","post","json","done","res","setItem","authorization","get","encodeURIComponent","g","location","href","props","query","next_url","fail","always","login","bind","handleChange","c","ref","React","Component","UserInfo","tip","isAdd","opType","currentUser","setBind","userId","init","updateUserInfo","changeRole","changePermissions","banUser","addUser","changeEdu","submit","key","set","edu","Edu","kDefault","Immutable","fromJS","format","setUser","parseInt","indexOf","delete","updateUser","valid","data","success","loading","update","setTip","alert","test","put","inputChange","isAdmin","_id","AdminEdu","EduDesc","map","eduDesc","Permissions","checkedPermissions","getPermissionsByModule","perm","i","UserStatistics","today","Date","monthFirst","getFullYear","getMonth","formatDate","dt","sprintf","getDate","dataReady","statistics","search","defaultDateRange","loadUserInfo","start","end","create","typeset","tag","volume","volume_items","review_tag","review_typeset","UserStatisticsPage","params","id","UserStatSearchBar","changeHandler","rangeName","range","getTime","Qdate","weekFirst","dateFormat","searchCallback","quickSearch","AddUser","UpdateUser","RecentOplogs","opLogs","days","results","opLog","index","OpLog","toLocaleString","ProfileRecentOpLogsPage","defaultProps","UserRecentOpLogsPage","UsersStatisticsPage","stats","dateStrToUnixTime","stat","_renderTr","UserInfoEditor","newPass","confirmPass","userEdu","userName","showPassForm","console","log","updateUserName","updateUserEdu","updateUserPass","btnStatus","invalid","successCallback","update_profile","ProfileEditor","UserStats","UserTr","validClass","permi","getPermDesc","showOp","UserList","users"],"mappings":"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","file":"user.js","sourcesContent":["import { setNavBar, NavItem } from 'js/nav';\r\nimport Global from \"global\";\r\n\r\nexport function setCurrentNav(current, uid, profile = false) {\r\n    let navItems = null;\r\n    if (uid) {\r\n        navItems = [\r\n            new NavItem('用户列表', '/users'),\r\n            new NavItem('全体统计', '/users/statistics'),\r\n            new NavItem('添加', '/admin/adduser'),\r\n            new NavItem('编辑', `/user/${uid}`),\r\n        ];\r\n        const permissions = Global.user.permissions.filter(p => p < 200);\r\n        if (permissions.length) {\r\n            navItems.push(new NavItem('用户统计', `/user/${uid}/statistics`));\r\n            navItems.push(new NavItem('最近操作', `/user/${uid}/op_logs/recent`));\r\n        }\r\n    } else if (profile) {\r\n        navItems = [\r\n            new NavItem('修改信息', '/profile'),\r\n        ];\r\n            // 不包含数学部权限的不显示用户统计\r\n        const permissions = Global.user.permissions.filter(p => p < 200);\r\n        if (permissions.length) {\r\n            navItems.push(new NavItem('用户统计', '/profile/statistics'));\r\n            navItems.push(new NavItem('最近操作', '/profile/op_logs/recent'));\r\n        }\r\n    } else {\r\n        navItems = [\r\n            new NavItem('用户列表', '/users'),\r\n            new NavItem('全体统计', '/users/statistics'),\r\n            new NavItem('添加', '/admin/adduser'),\r\n        ];\r\n    }\r\n    setNavBar(navItems, current);\r\n}\r\n\r\nexport class UserRole {\r\n    static isAdmin(role) {\r\n        return role === UserRole.kAdmin;\r\n    }\r\n}\r\n\r\nUserRole.kDescDict = {\r\n    1: '管理员',\r\n    10: '用户',\r\n};\r\n\r\nUserRole.kAdmin = 1;\r\nUserRole.kUser = 10;\r\n\r\nexport class UserModule {}\r\nUserModule.kAllModules = [\r\n    { code: 1, desc: '数学部' },\r\n];\r\nUserModule.kDescDict = {};\r\nUserModule.kAllModules.forEach((item) => { UserModule.kDescDict[item.code] = item.desc; });\r\nUserModule.kMathDepartment = 1;\r\nexport class UserPermission {\r\n    static getPermissionsByModule(module) {\r\n        if (module === UserModule.kMathDepartment) {\r\n            return UserPermission.kMathDepartment;\r\n        }\r\n        return null;\r\n    }\r\n}\r\nUserPermission.kMathDepartment = [\r\n    { code: 102, desc: '题目查询' },\r\n    { code: 103, desc: '试卷编辑' },\r\n    { code: 104, desc: '录入' },\r\n];\r\n\r\nUserPermission.kAll = {};\r\n[].concat(UserPermission.kMathDepartment).forEach(\r\n    (item) => { UserPermission.kAll[item.code] = item.desc; });\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/user/common.jsx","import React from 'react';\r\nimport ReactDom from 'react-dom';\r\nimport { Router, Route, browserHistory } from 'react-router';\r\nimport UserList from './userlist';\r\nimport { AddUser, UpdateUser, UserStatisticsPage } from './manageuser';\r\nimport { ProfileEditor, UserStats } from './userinfo';\r\nimport { UserLogin } from './login';\r\nimport { ProfileRecentOpLogsPage, UserRecentOpLogsPage } from './oplogs';\r\nimport { UsersStatisticsPage } from './stats';\r\n\r\nReactDom.render((\r\n    <Router history={browserHistory}>\r\n        <Route path='/users' component={UserList} />\r\n        <Route path='/users/statistics' component={UsersStatisticsPage} />\r\n        <Route path='/admin/adduser' component={AddUser} />\r\n        <Route path='/user/:id' component={UpdateUser} />\r\n        <Route path='/user/:id/statistics' component={UserStatisticsPage} />\r\n        <Route path='/user/:id/op_logs/recent' component={UserRecentOpLogsPage} />\r\n        <Route path='/profile' component={ProfileEditor} />\r\n        <Route path='/profile/statistics' component={UserStats} />\r\n        <Route path='/profile/op_logs/recent' component={ProfileRecentOpLogsPage} />\r\n        <Route path='/auth/login' component={UserLogin} />\r\n    </Router>\r\n), document.getElementById('main')\r\n);\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/user/entry.jsx","import React from 'react';\r\nimport Q from \"js/quantum\";\r\nimport \"css/main.scss\";\r\nimport config from '../../../config'\r\nexport class UserLogin extends React.Component {\r\n    constructor() {\r\n        super();\r\n        this.state = {\r\n            email: window.localStorage.getItem('loginName') || '',\r\n            pass: '',\r\n            capacha: '',\r\n            remember: true,\r\n            ajaxing: false,\r\n            imgSrc: this.genImgSrc()\r\n        };\r\n        this._refEmail = null;\r\n        this._refPass = null;\r\n        this._autoFocusInput = this.state.email ? 'pass' : 'email';\r\n    }\r\n    \r\n//  componentWillMount(){\r\n//  \tlocalStorage.removeItem('res_str');\r\n//  }\r\n\r\n    componentDidMount() {\r\n        if (this.state.email) {\r\n            this._refPass.focus();\r\n        } else {\r\n            this._refEmail.focus();\r\n        }\r\n    }\r\n\r\n    handleChange(evt) {\r\n        const value = evt.target.type === 'checkbox' ? evt.target.checked : evt.target.value;\r\n        this.setState({ [evt.target.name]: value });\r\n    }\r\n    genImgSrc = () => {\r\n        let server = `http://${config[process.env.NODE_ENV]['proxy']['english']['host']}:${config[process.env.NODE_ENV]['proxy']['english']['port']}`;\r\n        return `${server}/auth/verifycode?num=${Math.random()}`\r\n    }\r\n    refreshCode() {\r\n        this.codeImg.setAttribute('src', this.genImgSrc())\r\n    }\r\n    login(evt) {\r\n        evt.preventDefault();\r\n        this.setState({ ajaxing: true });\r\n        Q.post('/auth/login', { json: this.state })\r\n        .done((res) => {\r\n            window.localStorage.setItem('loginName', this.state.email);\r\n            localStorage.setItem('token', res.authorization);\r\n            Q.get('/user/current_user').done(res => {\r\n                window.localStorage.setItem('user', encodeURIComponent(JSON.stringify(res.g.user)));\r\n                location.href = this.props.location.query.next_url || '/';\r\n            }).fail(this.loginError)\r\n        })\r\n        .fail(this.loginError)\r\n        .always(() => {\r\n            this.setState({ ajaxing: false });\r\n        })\r\n        ;\r\n    }\r\n    loginError =()=> {\r\n        this._refPass.focus();\r\n        this.setState({ pass: '' });\r\n        this.refreshCode();\r\n    }\r\n    render() {\r\n        return (\r\n            <div id=\"login-page\">\r\n                <div className=\"login-header\">\r\n                    <div className=\"logo-wrapper\">\r\n                        <img src=\"http://sealimg.youneng.com/static/img/logo/logo_s.png\" />\r\n                    </div>\r\n                    <div className=\"sys-name-wrapper\">\r\n                        <img src=\"http://sealimg.youneng.com/static/img/logo/318x80_n.png\" />\r\n                    </div>\r\n                </div>\r\n                <div className=\"login-body\">\r\n                    <form id=\"login-form\" className=\"\" onSubmit={this.login.bind(this)}>\r\n                        <div className=\"form-row\">\r\n                            <input\r\n                                type=\"email\" name=\"email\" className=\"form-control\"\r\n                                placeholder=\"用户名\" required\r\n                                value={this.state.email}\r\n                                onChange={this.handleChange.bind(this)}\r\n                                ref={(c) => { this._refEmail = c; }} key=\"email\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"form-row\">\r\n                            <input\r\n                                type=\"password\" name=\"pass\" className=\"form-control\" required\r\n                                placeholder=\"密码\"\r\n                                value={this.state.pass} onChange={this.handleChange.bind(this)}\r\n                                ref={(c) => { this._refPass = c; }} key=\"pass\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"form-row\">\r\n                            <div className=\"capacha\">\r\n                                <input\r\n                                    type=\"text\" name=\"capacha\" className=\"form-control text\" required\r\n                                    placeholder=\"验证码\"\r\n                                    value={this.state.capacha} onChange={this.handleChange.bind(this)}\r\n                                />\r\n                                <img src={this.state.imgSrc} alt=\"\" ref={ref=> this.codeImg=ref} onClick={this.refreshCode.bind(this)}/>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"form-row\">\r\n                            <label className=\"checkbox-inline remember\" >\r\n                                <input\r\n                                    type=\"checkbox\" name=\"remember\" checked={this.state.remember}\r\n                                    onChange={this.handleChange.bind(this)}\r\n                                />\r\n                                <span>记住我</span>\r\n                            </label>\r\n                        </div>\r\n                        <div className=\"form-row\">\r\n                            <button\r\n                                className=\"btn btn-primary btn-lg\" type=\"submit\"\r\n                            >登录</button>\r\n                            <div className=\"forget-pass hide\">\r\n                                <a href=\"#\" data-action=\"forget-pass\">\r\n                                    忘记密码\r\n                                </a>\r\n                            </div>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/user/login.jsx","import React from 'react';\r\nimport { Q, Qdate, Edu, EduDesc } from \"js/quantum\";\r\nimport Immutable from 'immutable';\r\nimport { sprintf } from 'sprintf-js';\r\nimport Global from 'global';\r\nimport { setCurrentNav, UserRole, UserModule, UserPermission } from './common';\r\n\r\nclass UserInfo extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            tip: \"\",\r\n        };\r\n        this.isAdd = this.props.opType === \"addUser\";\r\n        this.currentUser = Global.user;\r\n        this.setBind();\r\n    }\r\n    componentDidMount() {\r\n        if (this.isAdd) {\r\n            setCurrentNav('添加');\r\n        } else {\r\n            setCurrentNav('编辑', this.props.userId);\r\n        }\r\n        this.init(this.isAdd);\r\n    }\r\n    setTip(tip) {\r\n        this.setState({ tip });\r\n    }\r\n    setBind() {\r\n        this.updateUserInfo = this.updateUserInfo.bind(this);\r\n        this.changeRole = this.changeRole.bind(this);\r\n        this.changePermissions = this.changePermissions.bind(this);\r\n        this.banUser = this.banUser.bind(this);\r\n        this.addUser = this.addUser.bind(this);\r\n        this.changeEdu = this.changeEdu.bind(this);\r\n        this.submit = this.submit.bind(this);\r\n    }\r\n    setUser(key, value) {\r\n        const user = this.state.user.set(key, value);\r\n        this.setState({ user });\r\n    }\r\n    init(isAdd) {\r\n        if (isAdd) {\r\n            const user = {\r\n                email: \"\",\r\n                name: \"\",\r\n                pass: \"\",\r\n                edu: Edu.kDefault,\r\n                role: UserRole.kUser,\r\n                permissions: [],\r\n            };\r\n            this.setState({ user: Immutable.fromJS(user) });\r\n        } else {\r\n            Q.get(`/api/user/${this.props.userId}`, { query: { format: \"json\" } })\r\n            .done((res) => {\r\n                this.setState({\r\n                    user: Immutable.fromJS(res),\r\n                });\r\n            });\r\n        }\r\n    }\r\n    inputChange(key, evt) {\r\n        const value = evt.target.value;\r\n        this.setUser(key, value);\r\n    }\r\n    changeRole(evt) {\r\n        const value = parseInt(evt.target.value, 10);\r\n        this.setUser('role', value);\r\n    }\r\n    changeEdu(evt) {\r\n        const value = parseInt(evt.target.value, 10);\r\n        const edu = this.state.user.get('edu');\r\n        if (edu !== value) {\r\n            this.setUser('edu', value);\r\n        }\r\n    }\r\n    changePermissions(evt) {\r\n        const value = parseInt(evt.target.value, 10);\r\n        let permissions = this.state.user.get('permissions');\r\n        if (permissions.indexOf(value) !== -1) {\r\n            permissions = permissions.delete(permissions.indexOf(value));\r\n        } else {\r\n            permissions = permissions.push(value);\r\n        }\r\n        this.setUser('permissions', permissions);\r\n    }\r\n    banUser() {\r\n        this.updateUser({ valid: !this.state.user.get(\"valid\") });\r\n    }\r\n    submit(evt) {\r\n        evt.preventDefault();\r\n        if (this.isAdd) {\r\n            return this.addUser(evt);\r\n        } else {\r\n            return this.updateUserInfo(evt);\r\n        }\r\n    }\r\n    updateUser(data, success) {\r\n        this.setState({ loading: true });\r\n        Q.post(`/api/user/${this.props.userId}`, { json: { update: data } })\r\n        .done((res) => {\r\n            this.setState({\r\n                user: Immutable.fromJS(res),\r\n            });\r\n            if (success) {\r\n                success();\r\n            }\r\n        })\r\n        .always(() => {\r\n            this.setState({ loading: false });\r\n        });\r\n    }\r\n    updateUserInfo() {\r\n        const user = this.state.user;\r\n        const pass = user.get(\"pass\");\r\n        if (pass && (pass.length < 6 || pass.length > 32)) {\r\n            this.setTip(\"密码需要6～32位！\");\r\n            return;\r\n        }\r\n        this.setTip(\"\");\r\n        const data = {\r\n            name: user.get(\"name\"),\r\n            role: user.get(\"role\"),\r\n            edu: user.get('edu'),\r\n            permissions: user.get('permissions'),\r\n            module: UserModule.kMathDepartment,\r\n        };\r\n        if (pass) {\r\n            data.pass = pass;\r\n        }\r\n        this.updateUser(data, () => { Q.alert(\"信息更新成功！\"); });\r\n    }\r\n    addUser() {\r\n        const user = this.state.user;\r\n        if (!/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$/.test(user.get(\"email\"))) {\r\n            this.setTip(\"不是合法的Email！\");\r\n            return;\r\n        }\r\n\r\n        const data = {\r\n            email: user.get(\"email\"),\r\n            name: user.get(\"name\"),\r\n            role: user.get(\"role\"),\r\n            pass: user.get('pass'),\r\n            edu: user.get(\"edu\"),\r\n            permissions: user.get('permissions'),\r\n            module: UserModule.kMathDepartment,\r\n        };\r\n        this.setState({ loading: true });\r\n        Q.put('/api/users', { json: data })\r\n        .done(() => {\r\n            Q.alert(\"添加成功\");\r\n            location.href = \"/users\";\r\n        })\r\n        .always(() => {\r\n            this.setState({ loading: false });\r\n        });\r\n    }\r\n    render() {\r\n        if (!this.state.user) {\r\n            return (\r\n                <div>数据加载中....</div>\r\n            );\r\n        }\r\n        return (\r\n            <form id=\"userinfo-form\" className=\"form-horizontal\" onSubmit={this.submit}>\r\n                <div className=\"form-group\">\r\n                    <label htmlFor=\"inputEmail\" className=\"col-sm-2 control-label\">邮箱</label>\r\n                    <div className=\"col-sm-8\">\r\n                        <input\r\n                            type=\"email\" id=\"inputEmail\" className=\"form-control\"\r\n                            disabled={!this.isAdd}\r\n                            value={this.state.user.get('email')}\r\n                            onChange={this.inputChange.bind(this, \"email\")}\r\n                        />\r\n                    </div>\r\n                </div>\r\n                <div className=\"form-group\">\r\n                    <label htmlFor=\"inputUserName\" className=\"col-sm-2 control-label\">用户名</label>\r\n                    <div className=\"col-sm-8\">\r\n                        <input\r\n                            type=\"text\" id=\"inputUserName\" className=\"form-control\"\r\n                            onChange={this.inputChange.bind(this, \"name\")}\r\n                            value={this.state.user.get('name')}\r\n                        />\r\n                    </div>\r\n                </div>\r\n                <div className={\"form-group\"}>\r\n                    <label htmlFor=\"inputPass\" className=\"col-sm-2 control-label\">密码</label>\r\n                    <div className=\"col-sm-8\">\r\n                        <input\r\n                            type=\"password\" id=\"inputPass\" className=\"form-control\"\r\n                            required={this.isAdd}\r\n                            onChange={this.inputChange.bind(this, \"pass\")}\r\n                            value={this.state.user.get('pass') || ''}\r\n                        />\r\n                    </div>\r\n                </div>\r\n                { UserRole.isAdmin(this.currentUser.role) ? (\r\n                    <AdminEdu\r\n                        edu={this.state.user.get('edu')}\r\n                        changeEdu={this.changeEdu}\r\n                    />) : null}\r\n                { UserRole.isAdmin(this.currentUser.role) && (\r\n                    this.state.user.get('_id') !== this.currentUser._id) ? (\r\n                        <div className=\"form-group\">\r\n                            <label htmlFor=\"inputRole\" className=\"col-sm-2 control-label\">角色</label>\r\n                            <div className=\"col-sm-8\">\r\n                                <select\r\n                                    className=\"form-control\" value={this.state.user.get('role')}\r\n                                    onChange={this.changeRole}\r\n                                >\r\n                                    <option value=\"10\">普通用户</option>\r\n                                    <option value=\"1\">管理员</option>\r\n                                </select>\r\n                            </div>\r\n                        </div>) : null}\r\n                { UserRole.isAdmin(this.currentUser.role) ? (\r\n                    <Permissions\r\n                        user={this.currentUser}\r\n                        permissions={this.state.user.get('permissions')}\r\n                        changePermissions={this.changePermissions}\r\n                    />) : null}\r\n                <div className={!this.isAdd ? \"form-group\" : \"hide\"}>\r\n                    <div className=\"col-sm-offset-2 col-sm-8\">\r\n                        <span\r\n                            className={this.state.user.get('valid') ?\r\n                            \"label label-success\" : \"label label-warning\"}\r\n                        >\r\n                            {this.state.user.get('valid') ? \"Active\" : \"Banned\"}\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n                <div className={this.state.tip !== \"\" ? 'form-group' : 'hide'}>\r\n                    <div className=\"col-sm-offset-2 col-sm-8\">\r\n                        <div className=\"alert alert-warning\">\r\n                            {this.state.tip}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className={\"form-group\"}>\r\n                    <div className=\"col-sm-offset-2 col-sm-8\">\r\n                        <button\r\n                            type=\"submit\" disabled={this.state.loading} className=\"btn btn-success\"\r\n                        >保存</button>\r\n                        &nbsp;&nbsp;\r\n                        <button\r\n                            type=\"button\" onClick={this.banUser} disabled={this.state.loading}\r\n                            className={`btn btn-danger ${this.isAdd ? 'hide' : ''}`}\r\n                        >{this.state.user.get('valid') ? \"禁用\" : \"激活\"}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        );\r\n    }\r\n}\r\n\r\nfunction AdminEdu(props) {\r\n    return (\r\n        <div className=\"form-group\">\r\n            <label htmlFor=\"inputEdu\" className=\"col-sm-2 control-label\">级段</label>\r\n            <div className=\"col-sm-8\">\r\n                <select\r\n                    className=\"form-control\" value={props.edu}\r\n                    onChange={props.changeEdu}\r\n                >\r\n                    {EduDesc.kAll.map(eduDesc =>\r\n                        <option value={eduDesc.edu}>{eduDesc.name}</option>)}\r\n                </select>\r\n            </div>\r\n        </div>);\r\n}\r\n\r\nfunction Permissions(props) {\r\n    const user = props.user;\r\n    const checkedPermissions = props.permissions;\r\n    if (!user.module) {\r\n        return null;\r\n    }\r\n    const permissions = UserPermission.getPermissionsByModule(user.module);\r\n\r\n    return (\r\n        <div className=\"form-group\">\r\n            <label className=\"col-sm-2 control-label\">权限</label>\r\n            <div className=\"col-sm-8\">\r\n                {\r\n                    permissions.map((perm, i) =>\r\n                        <label className=\"checkbox-inline\" key={i}>\r\n                            <input\r\n                                type=\"checkbox\" value={perm.code}\r\n                                checked={checkedPermissions.indexOf(perm.code) !== -1}\r\n                                onChange={props.changePermissions}\r\n                            />{perm.desc}\r\n                        </label>\r\n                    )\r\n                }\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nclass UserStatistics extends React.Component {\r\n    static defaultDateRange() {\r\n        const today = new Date();\r\n        const monthFirst = new Date(today.getFullYear(), today.getMonth(), 1);\r\n        return [UserStatistics.formatDate(monthFirst), UserStatistics.formatDate(today)];\r\n    }\r\n\r\n    static formatDate(dt) {\r\n        return sprintf(`%04d-%02d-%02d`, dt.getFullYear(), dt.getMonth() + 1, dt.getDate());\r\n    }\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            dataReady: false,\r\n            statistics: {},\r\n        };\r\n        this.setBind();\r\n    }\r\n    componentDidMount() {\r\n        this.search(...UserStatistics.defaultDateRange());\r\n        this.loadUserInfo();\r\n    }\r\n    setBind() {\r\n        this.search = this.search.bind(this);\r\n    }\r\n    loadUserInfo() {\r\n        Q.get(`/api/user/${this.props.uid}`)\r\n        .done((user) => {\r\n            this.user = user;\r\n            this.setState({\r\n                dataReady: true,\r\n            });\r\n        });\r\n    }\r\n    search(start, end) {\r\n        const query = {};\r\n        if (start) {\r\n            query.start = `${start} 00:00`;\r\n        }\r\n        if (end) {\r\n            query.end = `${end} 23:59`;\r\n        }\r\n        Q.get(`/api/user/${this.props.uid}/statistics`, { query })\r\n        .done((data) => {\r\n            this.setState({\r\n                statistics: data,\r\n            });\r\n        });\r\n    }\r\n    render() {\r\n        if (!this.state.dataReady) {\r\n            return null;\r\n        }\r\n        const statistics = this.state.statistics;\r\n        return (\r\n            <div id=\"user-statistics\">\r\n                <div className=\"panel panel-default\">\r\n                    <div className=\"panel-heading\">\r\n                        <span>{this.user.name || this.user.email}的工作量</span>\r\n                    </div>\r\n                    <div className=\"panel-body\">\r\n                        <div className=\"search-bar-wrapper\">\r\n                            <UserStatSearchBar\r\n                                defaultDateRange={UserStatistics.defaultDateRange()}\r\n                                searchCallback={this.search}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <table className=\"table table-striped table-hover\">\r\n                                <thead>\r\n                                    <tr>\r\n                                        <th>用户</th>\r\n                                        <th>创建题目</th>\r\n                                        <th>排版题目</th>\r\n                                        <th>标注题目</th>\r\n                                        <th>创建Volume</th>\r\n                                        <th>Volume题目数</th>\r\n                                        <th>标注</th>\r\n                                        <th>审核</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    <tr>\r\n                                        <td><span>{this.user.name || this.user.email}</span></td>\r\n                                        <td><span>{statistics.create}</span></td>\r\n                                        <td><span>{statistics.typeset}</span></td>\r\n                                        <td><span>{statistics.tag}</span></td>\r\n                                        <td><span>{statistics.volume}</span></td>\r\n                                        <td><span>{statistics.volume_items}</span></td>\r\n                                        <td><span>{statistics.review_tag}</span></td>\r\n                                        <td><span>{statistics.review_typeset}</span></td>\r\n                                    </tr>\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nclass UserStatisticsPage extends React.Component {\r\n    componentDidMount() {\r\n        setCurrentNav('用户统计', this.props.params.id);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <UserStatistics uid={this.props.params.id} />\r\n        );\r\n    }\r\n}\r\n\r\nexport class UserStatSearchBar extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            start: props.defaultDateRange[0],\r\n            end: props.defaultDateRange[1],\r\n        };\r\n        this.setBind();\r\n    }\r\n\r\n    setBind() {\r\n        this.changeHandler = this.changeHandler.bind(this);\r\n    }\r\n\r\n    changeHandler(key, evt) {\r\n        this.setState({\r\n            [key]: evt.target.value,\r\n        });\r\n    }\r\n\r\n    quickSearch(rangeName) {\r\n        let range = [new Date(), new Date()];\r\n        switch (rangeName) {\r\n        case 'yesterday':\r\n            range = [\r\n                new Date(new Date().getTime() - (86400 * 1000)),\r\n                new Date(new Date().getTime() - (86400 * 1000)),\r\n            ];\r\n            break;\r\n        case 'thisweek':\r\n            range = [\r\n                Qdate.weekFirst(),\r\n                new Date(),\r\n            ];\r\n            break;\r\n        case 'lastweek':\r\n            range = [\r\n                Qdate.weekFirst(new Date(Qdate.weekFirst().getTime() - 1)),\r\n                new Date(Qdate.weekFirst(\r\n                    new Date(Qdate.weekFirst().getTime() - 1)).getTime() + (6 * 86400 * 1000)),\r\n            ];\r\n            break;\r\n        default: break;\r\n        }\r\n        this.setState({\r\n            start: Qdate.dateFormat(range[0]),\r\n            end: Qdate.dateFormat(range[1]),\r\n        }, () => this.props.searchCallback(this.state.start, this.state.end));\r\n    }\r\n    render() {\r\n        return (\r\n            <form className=\"form-inline date-range-form\">\r\n                <div className=\"form-group\">\r\n                    <label>开始时间：</label>\r\n                    <input\r\n                        type=\"date\" className=\"form-control\" value={this.state.start}\r\n                        onChange={this.changeHandler.bind(this, 'start')}\r\n                    />\r\n                </div>\r\n                <div className=\"form-group\">\r\n                    <label>结束时间：</label>\r\n                    <input\r\n                        type=\"date\" className=\"form-control\" value={this.state.end}\r\n                        onChange={this.changeHandler.bind(this, 'end')}\r\n                    />\r\n                </div>\r\n                <button\r\n                    type=\"button\" className=\"btn btn-success\"\r\n                    onClick={() => this.props.searchCallback(this.state.start, this.state.end)}\r\n                >查询</button>\r\n                <button\r\n                    type=\"button\" className=\"btn btn-default\"\r\n                    onClick={this.quickSearch.bind(this, 'today')}\r\n                >今天</button>\r\n                <button\r\n                    type=\"button\" className=\"btn btn-default\"\r\n                    onClick={this.quickSearch.bind(this, 'yesterday')}\r\n                >昨天</button>\r\n                <button\r\n                    type=\"button\" className=\"btn btn-default\"\r\n                    onClick={this.quickSearch.bind(this, 'thisweek')}\r\n                >本周</button>\r\n                <button\r\n                    type=\"button\" className=\"btn btn-default\"\r\n                    onClick={this.quickSearch.bind(this, 'lastweek')}\r\n                >上周</button>\r\n            </form>\r\n        );\r\n    }\r\n}\r\n\r\nconst AddUser = function () {\r\n    return (\r\n        <UserInfo opType=\"addUser\" />\r\n    );\r\n};\r\n\r\nconst UpdateUser = function (props) {\r\n    return (\r\n        <UserInfo opType=\"updateUser\" userId={props.params.id} />\r\n    );\r\n};\r\n\r\nexport { AddUser, UpdateUser, UserStatistics, UserStatisticsPage };\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/user/manageuser.jsx","import React from 'react';\r\nimport Immutable from 'immutable';\r\nimport Q from 'js/quantum';\r\nimport Global from 'global';\r\nimport { setCurrentNav } from './common';\r\n\r\nexport class RecentOplogs extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            opLogs: null,\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        Q.get(`/api/user/${this.props.uid}/op_logs/recent`, { query: { days: this.props.days } })\r\n        .done((results) => { this.setState({ opLogs: Immutable.fromJS(results) }); });\r\n    }\r\n\r\n    render() {\r\n        if (this.state.opLogs === null) {\r\n            return <div className='loading'>正在加载中...</div>;\r\n        }\r\n        return (\r\n            <table className=\"table table-hover\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>序号</th>\r\n                        <th>时间</th>\r\n                        <th>类型</th>\r\n                        <th>ID</th>\r\n                        <th>操作</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    { this.state.opLogs.map((opLog, index) =>\r\n                        <OpLog index={index} opLog={opLog} key={index} />) }\r\n                </tbody>\r\n            </table>\r\n        );\r\n    }\r\n}\r\n\r\nfunction OpLog({ opLog, index }) {\r\n    return (\r\n        <tr>\r\n            <td>{index + 1}</td>\r\n            <td>{new Date(opLog.get('ctime') * 1000).toLocaleString()}</td>\r\n            <td>{opLog.get('obj_type')}</td>\r\n            <td>\r\n                <a href={`/${opLog.get('obj_type')}/${opLog.get('obj_id')}`} target='_blank'>\r\n                    {opLog.get('obj_id')}\r\n                </a>\r\n            </td>\r\n            <td>{opLog.get('type')}</td>\r\n        </tr>\r\n    );\r\n}\r\n\r\nexport class ProfileRecentOpLogsPage extends React.Component {\r\n    componentDidMount() {\r\n        setCurrentNav('最近操作', null, true);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div id=\"my-recent-op-logs\">\r\n                <h3>最近{this.props.days}天的操作</h3>\r\n                <RecentOplogs uid={Global.user._id} days={this.props.days} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nProfileRecentOpLogsPage.defaultProps = {\r\n    days: 7,\r\n};\r\n\r\nexport class UserRecentOpLogsPage extends React.Component {\r\n    componentDidMount() {\r\n        setCurrentNav('最近操作', this.props.params.id, false);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div id=\"user-recent-op-logs\">\r\n                <h3>最近{this.props.days}天的操作</h3>\r\n                <RecentOplogs uid={this.props.params.id} days={this.props.days} />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nUserRecentOpLogsPage.defaultProps = {\r\n    days: 7,\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/user/oplogs.jsx","import React from 'react';\r\nimport { Q, Qdate } from \"js/quantum\";\r\nimport \"css/main.scss\";\r\nimport { UserStatSearchBar } from './manageuser';\r\nimport { setCurrentNav } from './common';\r\n\r\n\r\nexport class UsersStatisticsPage extends React.Component {\r\n    static defaultDateRange() {\r\n        return [Qdate.dateFormat(new Date()), Qdate.dateFormat(new Date())];\r\n    }\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            stats: [],\r\n        };\r\n        this.setBind();\r\n    }\r\n\r\n    componentDidMount() {\r\n        setCurrentNav('全体统计', this.props.params.id);\r\n\r\n        this.search(...UsersStatisticsPage.defaultDateRange());\r\n    }\r\n\r\n    setBind() {\r\n        this.search = this.search.bind(this);\r\n    }\r\n\r\n    search(start, end) {\r\n        const query = {};\r\n        if (start) {\r\n            query.start = Q.dateStrToUnixTime(start) / 1000;\r\n        }\r\n        if (end) {\r\n            query.end = (Q.dateStrToUnixTime(end) / 1000) + 86400;\r\n        }\r\n        Q.get(`/api/users/statistics`, { query })\r\n        .done((data) => {\r\n            this.setState({\r\n                stats: data,\r\n            });\r\n        });\r\n    }\r\n\r\n    _renderTr(stat) {\r\n        return (\r\n            <tr key={stat._id}>\r\n                <td><span>{stat.name}</span></td>\r\n                <td><span>{stat.create}</span></td>\r\n                <td><span>{stat.typeset}</span></td>\r\n                <td><span>{stat.tag}</span></td>\r\n                <td><span>{stat.volume}</span></td>\r\n                <td><span>{stat.volume_items}</span></td>\r\n                <td><span>{stat.review_tag}</span></td>\r\n                <td><span>{stat.review_typeset}</span></td>\r\n            </tr>\r\n        );\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div id=\"user-statistics\">\r\n                <div className=\"panel panel-default\">\r\n                    <div className=\"panel-heading\">\r\n                        <span>全体工作统计</span>\r\n                    </div>\r\n                    <div className=\"panel-body\">\r\n                        <div className=\"search-bar-wrapper\">\r\n                            <UserStatSearchBar\r\n                                defaultDateRange={UsersStatisticsPage.defaultDateRange()}\r\n                                searchCallback={this.search}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <table className=\"table table-striped table-hover\">\r\n                                <thead>\r\n                                    <tr>\r\n                                        <th>用户</th>\r\n                                        <th>创建题目</th>\r\n                                        <th>排版题目</th>\r\n                                        <th>标注题目</th>\r\n                                        <th>创建Volume</th>\r\n                                        <th>Volume题目数</th>\r\n                                        <th>标注</th>\r\n                                        <th>审核</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    { this.state.stats.map(this._renderTr.bind(this)) }\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/user/stats.jsx","import React from 'react';\r\nimport { Q, EduDesc } from \"js/quantum\";\r\nimport Global from 'global';\r\nimport { setCurrentNav } from './common';\r\nimport { UserStatistics } from './manageuser';\r\n\r\nclass UserInfoEditor extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            tip: \"\",\r\n            newPass: \"\",\r\n            confirmPass: \"\",\r\n            edu: props.userEdu,\r\n            pass: \"\",\r\n            name: props.userName,\r\n            showPassForm: false,\r\n            loading: false,\r\n        };\r\n        this.setBind();\r\n    }\r\n           \r\n    componentWillMount(){\r\n    \tQ.get(`/api/user/${this.props.userId}`)\r\n        .done((res) => {\r\n        \tthis.setState({\r\n        \t\tedu:res.edu\r\n        \t},()=>{\r\n        \t\tGlobal.user.edu=res.edu;\r\n        \t\tconsole.log(Global.user.edu)\r\n        \t})\r\n        })\r\n    }\r\n    \r\n    componentDidMount() {\r\n        setCurrentNav('修改信息', null, true);\r\n    }\r\n\r\n    setBind() {\r\n        this.showPassForm = this.showPassForm.bind(this);\r\n        this.updateUserName = this.updateUserName.bind(this);\r\n        this.updateUserEdu = this.updateUserEdu.bind(this);\r\n        this.updateUserPass = this.updateUserPass.bind(this);\r\n    }\r\n\r\n    setTip(tip) {\r\n        this.setState({ tip });\r\n    }\r\n\r\n    changeEdu(evt) {\r\n        const value = parseInt(evt.target.value, 10);\r\n        const edu = this.state.edu;\r\n        if (edu !== value) {\r\n            this.setState({ edu: value });\r\n        }\r\n    }\r\n\r\n    inputChange(key, evt) {\r\n        const value = evt.target.value;\r\n        this.setState({ [key]: value });\r\n        const btnStatus = this.state.invalid;\r\n        this.setState({ invalid: btnStatus });\r\n    }\r\n\r\n    showPassForm() {\r\n        this.setState({ showPassForm: !this.state.showPassForm });\r\n    }\r\n\r\n    updateUserName() {\r\n        this.setTip(\"\");\r\n        if (!this.state.name) {\r\n            this.setTip(\"用户名不能为空!\");\r\n            return;\r\n        }\r\n        this.updateUserInfo({ name: this.state.name });\r\n    }\r\n\r\n    updateUserEdu() {\r\n        this.setTip('');\r\n        this.updateUserInfo({ edu: this.state.edu });\r\n        \r\n    }\r\n\r\n    updateUserPass() {\r\n        this.setTip(\"\");\r\n        if (!this.state.pass) {\r\n            this.setTip(\"密码为空!\");\r\n            return;\r\n        }\r\n        if (!this.state.newPass) {\r\n            this.setTip(\"新密码为空!\");\r\n            return;\r\n        }\r\n        if (this.state.newPass.length < 6 || this.state.pass.length < 6 ||\r\n            this.state.newPass.length > 32 || this.state.pass.length > 32) {\r\n            this.setTip(\"密码需要6～32位！\");\r\n            return;\r\n        }\r\n        if (this.state.newPass !== this.state.confirmPass) {\r\n            this.setTip(\"密码输入不一致！\");\r\n            return;\r\n        }\r\n        this.updateUserInfo({ pass: this.state.pass, newPass: this.state.newPass },\r\n            () => {\r\n                this.setState({ showPassForm: false });\r\n                Q.alert(\"信息更新成功\");\r\n            }\r\n        );\r\n    }\r\n\r\n    updateUserInfo(params, successCallback) {\r\n        this.setState({ loading: true });\r\n        this.setTip(\"\");\r\n        Q.post(`/api/user/${this.props.userId}`,\r\n               { json: { update_profile: params } }\r\n        )\r\n        .done((res) => {\r\n//      \tlocalStorage.setItem('eduChange',res.edu)\r\n        \tGlobal.user.edu=res.edu;\r\n        \tconsole.log(Global.user.edu)\r\n        \t\r\n            if (successCallback) {\r\n                successCallback();\r\n            } else {\r\n                Q.alert(\"信息更新成功\");\r\n            }\r\n        })\r\n        .fail(() => {\r\n            this.setState({ pass: \"\", newPass: \"\", confirmPass: \"\" });\r\n        })\r\n        .always(() => {\r\n            this.setState({ loading: false });\r\n        });\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <form id=\"userinfo-form\" className=\"form-horizontal\">\r\n                <div className=\"form-group\">\r\n                    <label htmlFor=\"inputEmail\" className=\"col-sm-2 control-label\">邮箱</label>\r\n                    <label className=\"col-sm-4 control-label text-left\">\r\n                        {this.props.email}\r\n                    </label>\r\n                </div>\r\n                <div className=\"form-group\">\r\n                    <label htmlFor=\"inputUserName\" className=\"col-sm-2 control-label\">用户名</label>\r\n                    <div className=\"col-sm-2\">\r\n                        <input\r\n                            type=\"text\" id=\"inputUserName\" className=\"form-control\"\r\n                            onChange={this.inputChange.bind(this, \"name\")}\r\n                            value={this.state.name}\r\n                        />\r\n                    </div>\r\n                    <div className=\"col-sm-2\">\r\n                        <button\r\n                            type=\"button\" onClick={this.updateUserName}\r\n                            disabled={this.state.loading} className=\"btn btn-success\"\r\n                        >保存</button>\r\n                    </div>\r\n                </div>\r\n                <div className=\"form-group\">\r\n                    <label htmlFor=\"inputUserEdu\" className=\"col-sm-2 control-label\">级段</label>\r\n                    <div className=\"col-sm-2\">\r\n                        <select\r\n                            id=\"inputUserEdu\"\r\n                            className=\"form-control\"\r\n                            value={this.state.edu}\r\n                            onChange={this.changeEdu.bind(this)}\r\n                        >\r\n                            {EduDesc.kAll.map(eduDesc =>\r\n                                <option\r\n                                    value={eduDesc.edu}\r\n                                    key={eduDesc.edu}\r\n                                >\r\n                                    {eduDesc.name}\r\n                                </option>)}\r\n                        </select>\r\n                    </div>\r\n                    <div className=\"col-sm-2\">\r\n                        <button\r\n                            type=\"button\" onClick={this.updateUserEdu}\r\n                            disabled={this.state.loading} className=\"btn btn-success\"\r\n                        >保存</button>\r\n                    </div>\r\n                </div>\r\n                <div className=\"form-group\">\r\n                    <label className=\"col-sm-2 control-label\">密码</label>\r\n                    <label className=\"col-sm-2 control-label text-left\">\r\n                        ******\r\n                    </label>\r\n                    <div className=\"col-sm-2\">\r\n                        <button\r\n                            type=\"button\" onClick={this.showPassForm}\r\n                            className=\"btn btn-success\"\r\n                        >{this.state.showPassForm ? '取消' : '修改密码'}</button>\r\n                    </div>\r\n                </div>\r\n                {\r\n                    this.state.showPassForm ? (\r\n                        <div>\r\n                            <div className=\"form-group\">\r\n                                <label htmlFor=\"inputPass\" className=\"col-sm-2 control-label\">\r\n                                    当前密码\r\n                                </label>\r\n                                <div className=\"col-sm-2\">\r\n                                    <input\r\n                                        type=\"password\" id=\"inputPass\" className=\"form-control\"\r\n                                        onChange={this.inputChange.bind(this, \"pass\")}\r\n                                        value={this.state.pass}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"form-group\">\r\n                                <label htmlFor=\"inputNewPass\" className=\"col-sm-2 control-label\">新密码\r\n                                </label>\r\n                                <div className=\"col-sm-2\">\r\n                                    <input\r\n                                        type=\"password\" id=\"inputNewPass\" className=\"form-control\"\r\n                                        onChange={this.inputChange.bind(this, \"newPass\")}\r\n                                        value={this.state.newPass}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"form-group\">\r\n                                <label\r\n                                    htmlFor=\"inputConfirmPass\"\r\n                                    className=\"col-sm-2 control-label\"\r\n                                >确认新密码</label>\r\n                                <div className=\"col-sm-2\">\r\n                                    <input\r\n                                        type=\"password\" id=\"inputConfirmPass\"\r\n                                        className=\"form-control\"\r\n                                        onChange={this.inputChange.bind(this, \"confirmPass\")}\r\n                                        value={this.state.confirmPass}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"form-group\">\r\n                                <div className=\"col-sm-offset-2 col-sm-8\">\r\n                                    <button\r\n                                        type=\"button\" onClick={this.updateUserPass}\r\n                                        disabled={this.state.loading} className=\"btn btn-success\"\r\n                                    >保存</button>\r\n                                </div>\r\n                            </div>\r\n                        </div>) : null\r\n                }\r\n                <div className={this.state.tip !== \"\" ? 'form-group' : 'hide'}>\r\n                    <div className=\"col-sm-offset-2 col-sm-8\">\r\n                        <div className=\"alert alert-warning\">\r\n                            { this.state.tip }\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        );\r\n    }\r\n}\r\n\r\nconst ProfileEditor = function () {\r\n    return (\r\n        <UserInfoEditor\r\n            email={Global.user.email}\r\n            userEdu={Global.user.edu}\r\n            userName={Global.user.name} userId={Global.user._id}\r\n        />\r\n    );\r\n};\r\n\r\nclass UserStats extends React.Component {\r\n    componentDidMount() {\r\n        setCurrentNav('用户统计', null, true);\r\n    }\r\n\r\n    render() {\r\n        return <UserStatistics uid={Global.user._id} />;\r\n    }\r\n}\r\n\r\nexport { ProfileEditor, UserStats };\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/user/userinfo.jsx","import React from 'react';\r\nimport Q from \"js/quantum\";\r\nimport \"css/main.scss\";\r\nimport Global from 'global';\r\nimport { setCurrentNav, UserRole, UserPermission } from './common';\r\n\r\nclass UserTr extends React.Component {\r\n\r\n    getPermDesc(perm) {\r\n        return UserPermission.kAll[perm];\r\n    }\r\n    render() {\r\n        const user = this.props.user;\r\n        this.currentUser = Global.user;\r\n        const validClass = user.valid ? \"label label-success\" : \"label label-warning\";\r\n        return (\r\n            <tr>\r\n                <td>\r\n                    <a href={`/user/${user._id}`}>\r\n                        <i className=\"glyphicon glyphicon-user\" />\r\n                        <span>{user.name}</span>\r\n                    </a>\r\n                </td>\r\n                <td><a href={`/user/${user._id}`}>{user.email}</a></td>\r\n                <td>\r\n                    {\r\n                        <span className={validClass}>\r\n                            {user.valid ? \"Active\" : \"Banned\"}\r\n                        </span>\r\n                     }\r\n                </td>\r\n                <td className=\"permissions-container\">\r\n                    {\r\n                         user.permissions.map((permi, i) => {\r\n                             return <span key={i}>{this.getPermDesc(permi)}</span>;\r\n                         })\r\n                     }\r\n                </td>\r\n                <td>\r\n                    <span>{UserRole.kDescDict[user.role]}</span>\r\n                </td>\r\n                { this.props.showOp ? (\r\n                    <td><a href={`/user/${user._id}/statistics`}>查看工作量</a></td>) : null\r\n                 }\r\n            </tr>\r\n        );\r\n    }\r\n}\r\n\r\nexport default class UserList extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            users: [],\r\n        };\r\n        this.currentUser = Global.user;\r\n    }\r\n    componentDidMount() {\r\n        setCurrentNav('用户列表');\r\n        this.init();\r\n    }\r\n    init() {\r\n        Q.get(\"/api/users\", { query: { format: \"json\" } })\r\n        .done((data) => {\r\n            this.setState({\r\n                users: data,\r\n            });\r\n        });\r\n    }\r\n    render() {\r\n        const permissions = Global.user.permissions.filter(p => p < 200);\r\n        const showOp = permissions.length > 0;   // 隐藏操作列\r\n        return (\r\n            <div id=\"users-list\">\r\n                <div className=\"userlist-container\">\r\n                    <table className=\"table table-wrapper\">\r\n                        <thead>\r\n                            <tr>\r\n                                <th>用户名</th>\r\n                                <th>邮箱</th>\r\n                                <th>状态</th>\r\n                                <th>权限</th>\r\n                                <th>角色</th>\r\n                                { showOp ? <th>操作</th> : null}\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {\r\n                                this.state.users.map(user =>\r\n                                    <UserTr key={user._id} user={user} showOp={showOp} />)\r\n                            }\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n                <a role=\"button\" className=\"btn btn-success\" href=\"/admin/adduser\">添加用户</a>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/user/userlist.jsx","module.exports = React;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"React\"\n// module id = 0\n// module chunks = 0 2 3","module.exports = ReactDOM;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ReactDOM\"\n// module id = 1\n// module chunks = 0 2 3","module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 2\n// module chunks = 0 2 3","module.exports = Immutable;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Immutable\"\n// module id = 3\n// module chunks = 0 2 3","module.exports = Global;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Global\"\n// module id = 4\n// module chunks = 0 2 3","module.exports = ReactRouter;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ReactRouter\"\n// module id = 5\n// module chunks = 0 2","module.exports = Raven;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Raven\"\n// module id = 7\n// module chunks = 0 2 3"],"sourceRoot":""}