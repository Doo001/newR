{"version":3,"sources":["webpack:///./js/portal.jsx","webpack:///external \"React\"?9de9*","webpack:///external \"ReactDOM\"?4ab4*","webpack:///external \"jQuery\"?0cb8*","webpack:///external \"Immutable\"?d3b4*","webpack:///external \"Global\"?3bd4*","webpack:///external \"Raven\"?5a37*"],"names":["Portal","props","redirect","item","url","indexOf","Q","get","done","data","window","location","href","state","dataReady","user","currentUser","Global","urlMap","desc","edu","title","userId","role","permissions","length","setState","portals","sort","push","forEach","p","e","stopPropagation","React","Component","ReactDom","render","document","getElementById"],"mappings":"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","file":"portal.js","sourcesContent":["import React from 'react';\r\nimport ReactDom from 'react-dom';\r\nimport Q from \"js/quantum\";\r\nimport Global from \"global\";\r\nimport \"css/main.scss\";\r\n\r\nclass Portal extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            dataReady: false,\r\n        };\r\n        this.user = null;\r\n        this.currentUser = Global.user;\r\n        this.urlMap = {\r\n            102: [{ url: '/item_search', desc: '查询题目' }],\r\n            103: [{ url: '/omega_papers', desc: '真题试卷' }],\r\n            104: [\r\n                { url: '/ktags/', desc: '知识点编辑' },\r\n                { url: '/volume/input', desc: '题目录入' },\r\n                { url: '/item/review?review=tag', desc: '标注' },\r\n                { url: '/item/review?review=typeset', desc: '审核' },\r\n                { url: `/lesson/${Global.user.edu}`, desc: '教案管理' },\r\n                {\r\n                    url: '/item/review?review=tag&subreview=retag',\r\n                    desc: '复标',\r\n                    title: '重新标注已跳过的题目',\r\n                },\r\n            ],\r\n            0: [{ url: '/users', desc: '用户管理' }],\r\n        };\r\n    }\r\n    componentDidMount() {\r\n        Q.get(`/api/user/${this.props.userId}`)\r\n        .done((data) => {\r\n            this.user = data;\r\n            if (this.user.role >= 10 && this.user.permissions.length === 1) {\r\n                if (this.urlMap[this.user.permissions[0]].length === 1) {\r\n                    window.location.href = this.urlMap[this.user.permissions[0]][0].url;\r\n                }\r\n            } else {\r\n                this.setState({\r\n                    dataReady: true,\r\n                });\r\n            }\r\n        });\r\n    }\r\n    redirect = (item) => {\r\n        if (item.url.indexOf('review') != -1) {\r\n            Q.get(item.url).done(data => {\r\n                if (data) {\r\n                    window.location.href = data;\r\n                }\r\n            })\r\n        } else {\r\n            window.location.href = item.url;\r\n        }\r\n    }\r\n    render() {\r\n        if (!this.state.dataReady) {\r\n            return null;\r\n        }\r\n        const portals = [];\r\n        const permissions = this.user.permissions.sort();\r\n        if (this.user.role < 10) {\r\n            permissions.push(0);\r\n        }\r\n        permissions.forEach((p) => {\r\n            if (!this.urlMap[p] || p === 101) {  // 暂时去掉书籍入口\r\n                return;\r\n            }\r\n            this.urlMap[p].forEach((item) => {\r\n                portals.push(\r\n                    <a\r\n                        className=\"module-portal\" onClick={e => {e.stopPropagation(); this.redirect(item)}} key={item.url}\r\n                        title={item.title || ''}\r\n                    >{item.desc}</a>\r\n            );\r\n            });\r\n        });\r\n        return (\r\n            <div id=\"home-module-portals\">\r\n                {portals}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nReactDom.render(\r\n    <Portal userId={Global.userId} />,\r\n    document.getElementById('main')\r\n);\r\n/* global userId*/\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/portal.jsx","module.exports = React;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"React\"\n// module id = 0\n// module chunks = 0 2 3","module.exports = ReactDOM;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ReactDOM\"\n// module id = 1\n// module chunks = 0 2 3","module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 2\n// module chunks = 0 2 3","module.exports = Immutable;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Immutable\"\n// module id = 3\n// module chunks = 0 2 3","module.exports = Global;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Global\"\n// module id = 4\n// module chunks = 0 2 3","module.exports = Raven;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Raven\"\n// module id = 7\n// module chunks = 0 2 3"],"sourceRoot":""}